[оглавление](../README.md)



## 14. Работа с Датами

В PHP присутствует полный набор средств, предназначенных для работы с датами и временем в различных форматах. Дополнительные модули (входящие в дистрибутив PHP и являющиеся стандартными) позволяют также работать с календарными функциями и календарями различных народов мира. Рассмотрим самые популярные из этих функций. 



## 14.1. Часовой пояс

Начиная с версии `PHP 5.1`, большинство функций для работы с датой и временем обращаются к директиве часового пояса `date.timezone`. Для настройки часового пояса, следует либо установить значение директивы `date.timezone` в конфигурационном файле `php.ini` 

```
date.timezone = "Europe/Moscow";
```

либо установить значение этой директивы при помощи функции `date_default_ timezone_set()` в начале скрипта:

```php
<?php
 date_default_timezone_set("Europe/Moscow");
 ... 
```



## 14.2. Время в формате timestamp 

```php
int time() 
```

Функция возвращает время в секундах, прошедшее с начала "эпохи UNIX" — полуночи `1 января 1970` года по Гринвичу. Этот формат данных принят в UNIX как стандартный: в частности, время последнего изменения файлов указывается именно в таком формате. Вообще говоря, почти все функции по работе со временем имеют дело именно с таким его представлением (которое называется unix timestamp). То есть представление "количество секунд с 1 января 1970 года" весьма универсально и, что главное, удобно. 



## 14.3. Построение строкового представления даты

```php
string date(string $format [,int $timestamp]) 
```

Эта функция очень полезна и весьма универсальна. Она возвращает строку, отформатированную в соответствии с параметром $format и сформированную на основе параметра $timestamp (если последний не задан, то на основе текущей даты). Строка формата может содержать обычный текст, перемежаемый одним или несколькими символами форматирования:

`U` — количество секунд, прошедших с полуночи 1 января 1970 года; 

`z` — номер дня от начала года; 

`Y` — год, 4 цифры; 

`y` — год, 2 цифры; 

`F` — название месяца, например, January; 

`m` — номер месяца; 

`M` — название месяца, трехсимвольная аббревиатура, например, Jan; 

`d` — номер дня в месяце, всегда 2 цифры (первая может быть 0); 

`j` — номер дня в месяце без предваряющего нуля; 

`w` — день недели, 0 соответствует воскресенью, 1 — понедельнику, и т. д.; 

`l` — день недели, текстовое полное название, например, Friday;

`D` — день недели, английское трехсимвольное сокращение, например, Fri; 

`a` — am или pm; 

`A` — AM или PM; 

`h` — часы, 12-часовой формат; 

`H` — часы, 24-часовой формат; 

`i` — минуты; 

`s` — секунды; 

`S` — английский числовой суффикс (nd, th и т. д.). 

Те символы, которые не были распознаны как форматирующие, подставляются в результирующую строку "как есть". Впрочем, не советуем этим злоупотреблять, поскольку довольно мало английских слов не содержат ни одной из перечисленных выше букв. Как видите, набор символов форматирования весьма и весьма богат. Пример использования функции `date()`:

```php
<?php 
 # Вывод дат
 echo date("l dS of F Y h:i:s A<br />");
 echo date("Сегодня d.m.Y<br />");
 echo date("Этот файл датирован d.m.Y<br />", filectime(__FILE__));
?> 
```



## 14.4 Построение timestamp

```php
int mktime(
 [int $hour]
 [, int $minute]
 [, int $second]
 [, int $month]
 [, int $day]
 [, int $year]
 [, int $is_dst = -1]) 
```

Функция `date()` преобразует формат timestamp в представление, удобное для человека. Так же, существует функция, которая проводит обратное преобразование — `mktime()`. Все ее параметры необязательны, но пропускать их можно, конечно же, только справа налево. Если какие-то параметры не заданы, на их место подставляются значения, соответствующие текущей дате. Последний параметр $is_dst устанавливается в 1 для летнего времени и в 0 для зимнего, для Российской Федерации этот параметр более не актуален. Функция возвращает значение в формате timestamp, соответствующее указанной дате. 

Правильность даты, переданной в параметрах, не проверяется. В случае некорректной даты ничего особенного не происходит — функция все равно формирует соответствующий формат timestamp.

```php
int strtotime(string $time [,int $timestamp]) 
```

При вызове `mktime()` легко перепутать порядок следования параметров и, таким образом, получить неверный результат. Функция `strtotime()` лишена этого недостатка. Она принимает строковое представление даты в свободном формате и возвращает соответствующий формат `timestamp`. 

Допустимые форматы описаны в документации: https://www.php.net/manual/ru/datetime.formats.php.

Примеры вызова `strtotime()`:

Формат ($time) | результат метка времени | получившаяся дата | текущая дата 
--- | --- | --- | ---
`now` | 1446405977 | `2015-11-01 19:26:17` | 2015-11-01 19:26:17
`10 September 2000` | 1441843200 | `2015-09-10 00:00:00` | 2015-11-01 19:26:17
`+1 day` | 1446492377 | `2015-11-02 19:26:17` | 2015-11-01 19:26:17 
`+1 week` | 1447010777 | `2015-11-08 19:26:17` | 2015-11-01 19:26:17 
`+1 week 2 days 4 hours 2 seconds` | 1447197979 | `2015-11-10 23:26:19` | 2015-11-01 19:26:17 
`next Thursday` | 1446681600 | `2015-11-05 00:00:00` | 2015-11-01 19:26:17 
`last Monday` | 1445817600 | `2015-10-26 00:00:00` | 2015-11-01 19:26:17



## 14.5 Разбор timestamp

```php
array getdate(int $timestamp)
```

Возвращает ассоциативный массив, содержащий данные об указанном времени. В массив будут помещены следующие ключи и значения: 

`seconds` — секунды; 

`minutes` — минуты; 

`hours` — часы; 

`mday` — число; 

`wday` — день недели (0 означает воскресенье, 1 — понедельник, и т. д.); 

`mon` — номер месяца; 

`year` — год; 

`yday` — номер дня с начала года; 

`weekday` — полное название дня недели, например, Friday; 

`month` — полное название месяца, например, January. 

В общем-то, всю эту информацию можно получить и с помощью функции date(), но тут разработчики PHP предоставляют нам альтернативный способ. 



## 14.6 Дата и время по Гринвичу 

До сих пор мы рассматривали так называемое локальное время — его показывают часы в том часовом поясе, где работает сервер. Представим, что вы находитесь, например, во Владивостоке, а ваш хостинг провайдер — в Москве. Вы заметите, что выдаваемое функциями `time()` и `date()` время отличается от времени Владивостока на несколько часов. Это происходит потому, что скрипт ориентируется на текущее время сервера, а не на местное время пользователя, запустившего сценарий из браузера. 

### Время по GMT 

Для того чтобы не путаться в часовых поясах, придумали специальный формат времени — `гринвичский` (Greenwich Mean Time, `GMT`; еще одна аббревиатура, обозначающая то же самое — `UTC`). Время по Гринвичу — это то время, которое в настоящий момент показывают часы в г. Гринвич (это в Англии). Там же проходит знаменитый "нулевой меридиан". 

Для обозначения времени в других часовых поясах принята запись 
```
GMT +ЧЧ00
```
или 
```
GMT +ЧЧ:00
```
где `ЧЧ` — разница времени в часах. Например, обозначение Москвы — 
```
GMT +0300
```
Это означает, что время в Москве на 3 часа отличается от времени нулевого меридиана (в большую сторону). Выше мы рассматривали функции, "ничего не знающие" о текущем часовом поясе. Эти функции всегда работают так, будто бы мы находимся в г. Гринвич, и не делают поправки на разность времени. В PHP существует ряд функций, которые принимают в параметрах локальное время и возвращают различным образом оформленные даты, которые в текущий момент актуальны на нулевом меридиане. Это, например, функция `gmdate()`, предназначенная для получения строкового представления даты по GMT, или функция `gmmktime()`, создающая timestamp-формат по указанной ей локальной дате. 



### Источники

- https://www.php.net/
- PHP7. Дмитрий Котеров, Игорь Симдянов



[оглавление](../README.md)